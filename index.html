<html lang="en" ng-app="app">

<head>
    <meta name="viewport" content="initial-scale=1" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.0-rc3/angular-material.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=RobotoDraft:300,400,500,700,400italic">

    <style>

        body {
            padding-top: 5vw;
        }

        .test-input {
            display: block;
            width: 100%;
            transition: 0.3s;
            padding: 5px;
        }

        .test-input:focus {
            outline: 1px solid blue;
            background: #EBEBEB;
        }

        .clear-autocomplete {
            position: absolute;
            top: 20%;
            right: 8px;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.25s linear;
        }

        .clear-autocomplete.visible {
            visibility: visible;
            opacity: 1;
            cursor: pointer;
        }

        .clear-autocomplete i {
            font-size: 20px;
        }

        .clear-autocomplete {
            cursor: pointer;
            -webkit-user-select: none;
        }

        .hidden {
            display: none !important;
        }

        [md-highlight-text] .highlight {
            color: red !important;
            font-weight: bold;
        }

        md-autocomplete input {
            transition: color 0.3s;
        }

        md-autocomplete.error input {
            color: red !important;
        }

        md-autocomplete.error input:hover {
            text-decoration: underline;
            cursor: pointer;
        }

    </style>

</head>

<body>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-route.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular-messages.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.0-rc3/angular-material.min.js"></script>

    <script>
        angular
            .module('app', ['ngMaterial', 'ngMessages'])
            .run(function($rootScope) {
                $rootScope.autocompleteItems = [ 'Broccoli', 'Cabbage', 'Carrot', 'Lettuce', 'Spinach' ];
                $rootScope.items             = [];
                $rootScope.searchText        = 'Some predefined value';
            })
            .directive('mdBlur', function($mdUtil, $timeout) {
                return {
                    require: "^mdAutocomplete",
                    link: function($scope, $element, $attributes, $mdAutocompleteCtrl) {
                        $timeout(function() {
                            var input      = $element.find("input");
                            var element    = $element[0];
                            var nativeBlur = $mdAutocompleteCtrl.blur;

                            $mdAutocompleteCtrl.blur = function() {
                                nativeBlur.call($mdAutocompleteCtrl);
                                $mdUtil.nextTick(function () {
                                    $scope.$eval($attributes.mdBlur, {"$mdAutocomplete": $mdAutocompleteCtrl });
                                    $element.addClass('error');
                                });
                            };
                        });
                    }
                };
            })
            .directive('mdFocus', function($mdUtil, $timeout) {
                return {
                    require: "^mdAutocomplete",
                    link: function($scope, $element, $attributes, $mdAutocompleteCtrl) {
                        $timeout(function() {
                            var input      = $element.find("input");
                            var element    = $element[0];
                            var nativeFocus = $mdAutocompleteCtrl.focus;

                            $mdAutocompleteCtrl.focus = function(e) {

                                // prevent selection
                                var value = $element.find('input').val();
                                $element.find('input').val(value);

                                nativeFocus.call($mdAutocompleteCtrl);

                                $mdUtil.nextTick(function () {
                                    $scope.$eval($attributes.mdBlur, {"$mdAutocomplete": $mdAutocompleteCtrl });
                                    $element.removeClass('error');
                                });
                            };
                        });
                    }
                };
            })

            .directive('mdAutocomplete', function () {
                var ddo = {
                    link: link,
                    require: 'mdAutocomplete'
                };

                return ddo;

                function link( scope, element, attrs, ctrl ) {

                    element.on('keydown', function onKeyDown(e) {

                        var isTabPressed = e.keyCode === 9;
                        var inputValue = scope.searchText;

                        if ( inputValue ) return;

                        if (isTabPressed) {
                            e.preventDefault();
                            // ctrl.index = 3;

                            ctrl.listEnter();
                        }

                    });

                }
            })

        .directive('clearAutocomplete', clearAutocomplete)
        .directive('mdHideAutocompleteOnEnter', function () {
            return function (scope, element, attrs) {
                element.bind("keydown keypress keyup", function (event) {
                    console.log(event.keyCode);

                    if (event.keyCode === 40 || event.keyCode === 38) {
                        scope.$apply(function (){
                            scope.$$childHead.$mdAutocompleteCtrl.hidden = false;
                        });

                        event.preventDefault();

                        return;
                    }

                    if (event.which === 13) {
                        scope.$apply(function (){
                            scope.$$childHead.$mdAutocompleteCtrl.hidden = true; // $scope  modified to scope
                        });

                        event.preventDefault();
                    }
                });
            };
        });

        function clearAutocomplete($parse, $rootScope) {
        return {
            restrict: 'A',
            link: function(scope, element, attrs) {
            var button = angular.element('<md-button>').addClass('clear-autocomplete');
            button.append('<i class="material-icons">X</i>');
            element.append(button);

            var searchTextModel = $parse(attrs.mdSearchText);

            scope.$watch(searchTextModel, function(searchText) {
                if (searchText && searchText !== '' && searchText !== null) {
                    button.addClass('visible');
                } else {
                    button.removeClass('visible');
                }
            });

            button.on('click', function() {

                $rootScope.$apply(function() {
                    searchTextModel.assign(scope, undefined);
                });

            });
        }
    }
}


    </script>

    <input type="text" placeholder="input for keyboard navigation test" class="test-input" id="temp" autofocus>
    <input type="text" placeholder="input for keyboard navigation test" class="test-input">

    <md-autocomplete
            required
            clear-autocomplete
            md-hide-autocomplete-on-enter
            md-blur
            md-focus
            md-input-name="autocompleteField"
            md-items="item in autocompleteItems"
            md-item-text="item"
            md-no-cache="true"
            md-min-length="0"
            placeholder="Single picker"
            md-match-case-insensitive="true"
            md-select-on-match="true"
            md-floating-label="Single picker"
        >
            <md-item-template>
                <span md-highlight-flags="^i" md-highlight-text="searchText">{{ item }}</span>
        </md-item-template>

        <md-not-found>
            No matches found.
        </md-not-found>
        </md-autocomplete>

    <md-autocomplete
            required
            clear-autocomplete
            md-blur
            md-focus
            md-input-name="autocompleteField"
            md-search-text="searchText"
            md-items="item in autocompleteItems"
            md-item-text="item"
            md-no-cache="true"
            md-min-length="0"
            placeholder="Single picker"
            md-match-case-insensitive="true"
            md-select-on-match="true"
            md-floating-label="Single picker"
        >
            <md-item-template>
                <span md-highlight-flags="^i" md-highlight-text="searchText">{{ item }}</span>
        </md-item-template>

        <md-not-found>
            No matches found.
        </md-not-found>

            <!-- <div ng&#45;messages="searchForm.autocompleteField.$error" ng&#45;if="searchForm.autocompleteField.$touched"> -->
            <!--     <div ng&#45;message="required">You <b>must</b> have a favorite state.</div> -->
            <!--     <div ng&#45;message="minlength">Your entry is not long enough.</div> -->
            <!--     <div ng&#45;message="maxlength">Your entry is too long.</div> -->
            <!-- </div> -->

    </md-autocomplete>

<!--  http://codepen.io/topherfangio/pen/qOyrqE?editors=101 -->
<!-- http://stackoverflow.com/questions/31858787/angular&#45;material&#45;md&#45;autocomplete&#45;how&#45;to&#45;hide&#45;md&#45;autocomplete&#45;suggestions&#45;on&#45;e -->
<!-- https://codepen.io/londovir/pen/GJpdGR?editors=1010 -->

</body>
</html>
